<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Frame Video – Preview Responsif</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f9f9f9;
      color: #333;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    input, button {
      font-size: 1rem;
    }
    #gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 10px;
      margin-top: 20px;
    }
    #gallery img {
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
      transition: transform .2s;
    }
    #gallery img:hover {
      transform: scale(1.05);
    }
    /* Modal Responsif */
    .modal {
      display: none;
      position: fixed;
      z-index: 10;
      inset: 0; /* top/right/bottom/left = 0 */
      background: rgba(0,0,0,0.85);
      align-items: center;
      justify-content: center;
      padding: 10px; /* beri ruang di tepi */
    }
    .modal-content {
      position: relative;
      max-width: 100%;
      max-height: 100%;
    }
    .modal-content img {
      display: block;
      width: auto;
      height: auto;
      max-width: 100vw;
      max-height: 100vh;
      border-radius: 4px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.5);
      margin: 0 auto;
    }
    .modal-close,
    .modal-download {
      position: absolute;
      top: 10px;
      padding: 8px 12px;
      font-size: 0.9rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: rgba(255,255,255,0.9);
    }
    .modal-close { right: 10px; }
    .modal-download { right: 100px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Ekstraksi Frame + Preview Responsif</h1>
    <p>Pilih video, atur FPS, ekstrak, lalu klik thumbnail untuk preview full responsif.</p>

    <input type="file" id="videoFile" accept="video/*" /><br/><br/>
    <label>FPS:</label>
    <input type="number" id="fpsInput" value="25" min="1" max="60" /><br/><br/>
    <button id="extractBtn" disabled>Ekstrak Frame</button>
    <div id="status" style="margin-top:10px;"></div>
    <div id="gallery"></div>
  </div>

  <!-- Modal Preview -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <button class="modal-download">Download</button>
      <button class="modal-close">Close</button>
      <img id="modalImg" src="" alt="Full Frame" />
    </div>
  </div>

  <!-- Elemen tersembunyi untuk pemrosesan -->
  <video id="hiddenVideo" style="display:none;"></video>
  <canvas id="hiddenCanvas" style="display:none;"></canvas>

  <script>
    const videoFile = document.getElementById('videoFile');
    const fpsInput = document.getElementById('fpsInput');
    const extractBtn = document.getElementById('extractBtn');
    const statusDiv = document.getElementById('status');
    const gallery = document.getElementById('gallery');
    const hiddenVideo = document.getElementById('hiddenVideo');
    const hiddenCanvas = document.getElementById('hiddenCanvas');
    const ctx = hiddenCanvas.getContext('2d');

    const modal = document.getElementById('modal');
    const modalImg = document.getElementById('modalImg');
    const btnClose = modal.querySelector('.modal-close');
    const btnDownload = modal.querySelector('.modal-download');

    let userFPS = 25;

    videoFile.addEventListener('change', () => {
      const file = videoFile.files[0];
      if (!file) return;
      hiddenVideo.src = URL.createObjectURL(file);
      extractBtn.disabled = false;
      gallery.innerHTML = '';
      statusDiv.textContent = '';
    });

    fpsInput.addEventListener('change', () => {
      const val = parseInt(fpsInput.value, 10);
      if (val >= 1 && val <= 60) userFPS = val;
      else fpsInput.value = userFPS;
    });

    extractBtn.addEventListener('click', () => {
      extractBtn.disabled = true;
      statusDiv.textContent = 'Memuat video...';
      hiddenVideo.load();
      hiddenVideo.addEventListener('loadedmetadata', onLoadedMeta);
    });

    function onLoadedMeta() {
      const duration = hiddenVideo.duration;
      const total = Math.floor(duration * userFPS);
      statusDiv.textContent = `Durasi: ${duration.toFixed(2)} detik, FPS: ${userFPS}, Frame ~ ${total}`;
      hiddenCanvas.width = hiddenVideo.videoWidth;
      hiddenCanvas.height = hiddenVideo.videoHeight;
      hiddenVideo.removeEventListener('loadedmetadata', onLoadedMeta);
      captureLoop(0, total);
    }

    function captureLoop(i, total) {
      if (i > total) {
        statusDiv.textContent = `Selesai mengekstrak ${total} frame.`;
        return;
      }
      hiddenVideo.currentTime = i / userFPS;
      hiddenVideo.addEventListener('seeked', function onSeeked() {
        ctx.drawImage(hiddenVideo, 0, 0, hiddenCanvas.width, hiddenCanvas.height);
        const dataURL = hiddenCanvas.toDataURL('image/jpeg');
        const img = document.createElement('img');
        img.src = dataURL;
        img.alt = `Frame ${i}`;
        img.dataset.full = dataURL;
        img.addEventListener('click', () => openModal(dataURL));
        gallery.appendChild(img);
        hiddenVideo.removeEventListener('seeked', onSeeked);
        if (i % Math.ceil(total/10) === 0) {
          statusDiv.textContent = `Mengekstrak frame ${i} / ${total}`;
        }
        setTimeout(() => captureLoop(i + 1, total), 0);
      });
    }

    function openModal(src) {
      modalImg.src = src;
      btnDownload.setAttribute('href', src);
      btnDownload.setAttribute('download', 'frame.jpg');
      modal.style.display = 'flex';
    }

    btnClose.addEventListener('click', () => {
      modal.style.display = 'none';
      modalImg.src = '';
    });

    modal.addEventListener('click', e => {
      if (e.target === modal) btnClose.click();
    });
  </script>
</body>
</html>
